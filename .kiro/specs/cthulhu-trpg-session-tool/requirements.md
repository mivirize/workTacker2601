# Requirements Document

## Introduction

Project Cは「セッションを創作活動に変える」をビジョンに掲げた、クトゥルフ神話TRPGに特化したオンラインセッションツールです。従来の「快適なプレイ環境」に加えて、セッション体験そのものを「二次創作の種」に変えることで、独自の価値を提供します。ターゲットユーザーは、クトゥルフ神話TRPGをプレイするすべてのプレイヤーとキーパー（KP）、特にセッションログを二次創作に活用したいクリエイティブなユーザーです。

## Requirements

### Requirement 1: ユーザー認証システム

**User Story:** ユーザーとして、Googleアカウントを使用して迅速にログインしたい。そうすることで、面倒な登録手続きなしにすぐにサービスを利用開始できる。

#### Acceptance Criteria

1. WHEN ユーザーがログインページにアクセス THEN システム SHALL Googleログインボタンを表示する
2. WHEN ユーザーがGoogleログインボタンをクリック THEN システム SHALL Googleの認証画面にリダイレクトする
3. WHEN Google認証が成功 THEN システム SHALL ユーザーをメインダッシュボードにリダイレクトする
4. WHEN 認証に失敗 THEN システム SHALL エラーメッセージを表示し、再試行を促す

### Requirement 2: キャラクターシート管理機能

**User Story:** プレイヤーとして、クトゥルフ神話TRPG（6版・7版）に準拠したキャラクターシートを作成・編集・保存・共有したい。そうすることで、セッションの準備を効率的に行える。

#### Acceptance Criteria

1. WHEN ユーザーが新規キャラクター作成を選択 THEN システム SHALL 6版または7版のルール選択画面を表示する
2. WHEN ルールが選択された THEN システム SHALL 対応するキャラクターシート入力フォームを表示する
3. WHEN キャラクター情報が入力され保存ボタンがクリックされた THEN システム SHALL キャラクターシートを保存し、確認メッセージを表示する
4. WHEN 無料ユーザーが保存上限（2件）に達している THEN システム SHALL 有料プラン案内を表示する
5. WHEN キャラクターシート共有ボタンがクリックされた THEN システム SHALL 共有用URLを生成し、コピー可能な状態で表示する

### Requirement 3: ダイス機能

**User Story:** プレイヤー・キーパーとして、クトゥルフ神話TRPGのルールに沿ったダイスロールを行いたい。そうすることで、正確で視覚的に分かりやすい判定結果を得られる。

#### Acceptance Criteria

1. WHEN ユーザーがダイスロールを実行 THEN システム SHALL クトゥルフ神話TRPGのルールに従って判定を行う
2. WHEN 判定結果が表示される THEN システム SHALL 成功・失敗を視覚的に分かりやすく表示する
3. WHEN クリティカル成功またはファンブルが発生 THEN システム SHALL 特別な視覚効果で結果を強調表示する
4. WHEN ダイスロール履歴が必要 THEN システム SHALL セッション中のすべてのダイスロール結果を記録・表示する

### Requirement 4: シナリオ管理機能

**User Story:** キーパーとして、事前にシナリオの情報を登録し、セッション中に演出素材を簡単に呼び出したい。そうすることで、スムーズで没入感のある進行ができる。

#### Acceptance Criteria

1. WHEN キーパーがシナリオ作成を選択 THEN システム SHALL シナリオ情報入力フォームを表示する
2. WHEN シーンごとの演出素材（音楽、テキスト、画像）が登録される THEN システム SHALL 素材を保存し、シーン一覧に表示する
3. WHEN セッション中に演出素材が必要 THEN システム SHALL ワンクリックで素材を呼び出し・再生する
4. WHEN 演出素材が再生される THEN システム SHALL 参加者全員に同期して素材を配信する

### Requirement 5: AI描写補助機能

**User Story:** キーパーとして、簡単なキーワードから詳細な情景描写を生成してもらいたい。そうすることで、より豊かな世界観をプレイヤーに伝えられる。

#### Acceptance Criteria

1. WHEN キーパーがキーワードを入力し描写生成を実行 THEN システム SHALL AIを使用して詳細な描写文を生成する
2. WHEN 描写文が生成される THEN システム SHALL 生成された文章をチャットにコピー可能な形で表示する
3. WHEN 有料ユーザーでない場合 THEN システム SHALL 利用回数制限を適用し、上限に達した場合は有料プラン案内を表示する
4. WHEN 生成された描写が気に入らない THEN システム SHALL 再生成オプションを提供する

### Requirement 6: AIロールプレイ提案機能

**User Story:** プレイヤーとして、キャラクターのロールプレイに悩んだ時、AIから状況に応じた提案をもらいたい。そうすることで、より没入感のあるロールプレイができる。

#### Acceptance Criteria

1. WHEN プレイヤーが現在の状況を入力しロールプレイ提案を要求 THEN システム SHALL キャラクターの性格に合わせた複数の提案を生成する
2. WHEN SANチェック失敗などの特定状況が発生 THEN システム SHALL 自動的に状況に応じたロールプレイ選択肢を提案する
3. WHEN 提案が表示される THEN システム SHALL 複数の選択肢から選べる形で提示する
4. WHEN 有料ユーザーでない場合 THEN システム SHALL 利用回数制限を適用する

### Requirement 7: セッションログ保存機能

**User Story:** ユーザーとして、音声とチャットログをセッションごとに自動保存してもらいたい。そうすることで、後から振り返りや二次創作に活用できる。

#### Acceptance Criteria

1. WHEN セッションが開始される THEN システム SHALL 音声とチャットの記録を自動的に開始する
2. WHEN セッションが終了する THEN システム SHALL すべてのログを自動保存し、保存完了を通知する
3. WHEN ユーザーがログにアクセス THEN システム SHALL セッション一覧から選択可能な形でログを表示する
4. WHEN プライバシー設定が必要 THEN システム SHALL ログの公開範囲を設定可能にする

### Requirement 8: AIあらすじ生成機能

**User Story:** ユーザーとして、セッションログから自動であらすじを生成してもらいたい。そうすることで、内容を簡単に友人と共有できる。

#### Acceptance Criteria

1. WHEN ユーザーがあらすじ生成を要求 THEN システム SHALL 保存されたログから要点を抽出し、簡潔なあらすじを生成する
2. WHEN あらすじが生成される THEN システム SHALL SNS共有用のフォーマットで表示する
3. WHEN 共有ボタンがクリックされる THEN システム SHALL 主要SNSへの直接投稿機能を提供する
4. WHEN 有料ユーザーでない場合 THEN システム SHALL 利用回数制限を適用する

### Requirement 9: AI小説生成機能

**User Story:** ユーザーとして、セッションのログから挿絵付きの小説を自動生成してもらいたい。そうすることで、リプレイを物語として残せる。

#### Acceptance Criteria

1. WHEN ユーザーが小説生成を要求 THEN システム SHALL チャットログを自然な会話に、ダイスロールを臨場感ある描写に変換する
2. WHEN 小説が生成される THEN システム SHALL 状況に合わせた挿絵を自動生成し、適切な位置に挿入する
3. WHEN 生成が完了する THEN システム SHALL 完成した小説をダウンロード可能な形式（PDF、EPUB等）で提供する
4. WHEN 有料ユーザーでない場合 THEN システム SHALL 利用回数制限を適用する

### Requirement 10: モダンUI/UXとスキン機能

**User Story:** ユーザーとして、直感的で洗練されたUIを使用し、好みに応じてカスタマイズしたい。そうすることで、快適で個性的なセッション環境を構築できる。

#### Acceptance Criteria

1. WHEN 初回ユーザーがアクセス THEN システム SHALL 直感的で迷わない操作が可能なUIを提供する
2. WHEN ユーザーがスキン変更を選択 THEN システム SHALL 利用可能なスキン一覧を表示する
3. WHEN 有料スキンが選択される THEN システム SHALL 購入手続きを案内し、購入後に適用する
4. WHEN スキンが適用される THEN システム SHALL 全画面に一貫したデザインを適用する