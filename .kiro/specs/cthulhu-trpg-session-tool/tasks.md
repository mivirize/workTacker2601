# Implementation Plan

- [x] 1. プロジェクト基盤とコア設定の構築





  - Next.js 14プロジェクトの初期化とApp Routerの設定
  - TypeScript、ESLint、Prettierの設定
  - Tailwind CSSの導入と基本スタイル設定
  - _Requirements: 10.1, 10.4_
-

- [ ] 2. データベースとORM設定










  - PostgreSQLデータベースの設計と作成
  - Prismaスキーマの定義（users, character_sheets, sessions, session_logs）
  - データベースマイグレーションの実行
  - _Requirements: 2.3, 7.2_


- [ ] 3. 認証システムの実装




  - NextAuth.jsの設定とGoogle OAuth Providerの統合
  - 認証ミドルウェアの実装
  - ログイン・ログアウト機能のテスト作成


  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 4. 基本UIコンポーネントの作成

  - レイアウトコンポーネント（Header, Sidebar, Footer）の実装
  - 共通UIコンポーネント（Button, Input, Modal）の作成

  - スキン機能の基盤となるテーマシステムの実装
  - _Requirements: 10.1, 10.2, 10.4_

- [ ] 5. ダッシュボード画面の実装

  - ユーザーダッシュボードのレイアウト作成

  - セッション一覧表示機能の実装
  - キャラクター一覧表示機能の実装
  - クイックアクション機能の実装
  - _Requirements: 10.1_

- [ ] 6. キャラクターシート管理機能の実装

- [ ] 6.1 キャラクターシートデータモデルの実装
  - CharacterSheetインターフェースの定義
  - 6版・7版対応のバリデーション関数の作成
  - キャラクターシートCRUD操作のAPI実装
  - _Requirements: 2.1, 2.2, 2.3_

- [ ] 6.2 キャラクターシート作成・編集UIの実装
  - ルール選択（6版/7版）画面の作成
  - 能力値入力フォームの実装
  - スキル入力フォームの実装
  - バックグラウンド情報入力フォームの実装
  - _Requirements: 2.1, 2.2_

- [ ] 6.3 キャラクターシート保存・共有機能の実装

  - 保存機能とバリデーションの実装
  - 無料ユーザーの保存上限制御の実装
  - 共有URL生成機能の実装
  - 共有されたキャラクターシートの表示機能の実装
  - _Requirements: 2.3, 2.4, 2.5_

- [ ] 7. ダイス機能の実装

- [ ] 7.1 ダイスロール計算エンジンの実装
  - クトゥルフ神話TRPG判定ロジックの実装
  - クリティカル・ファンブル判定の実装
  - ダイスロール結果の型定義とバリデーション
  - _Requirements: 3.1, 3.3_

- [ ] 7.2 ダイスUIとビジュアルフィードバックの実装
  - ダイスロールボタンとパネルの作成
  - 成功・失敗の視覚的表示の実装
  - クリティカル・ファンブル時の特別エフェクトの実装
  - ダイスロール履歴表示の実装
  - _Requirements: 3.2, 3.4_

- [ ] 8. リアルタイム通信基盤の構築

  - Socket.ioサーバーとクライアントの設定
  - セッションルーム管理機能の実装
  - リアルタイムチャット機能の実装
  - ダイスロール結果の同期機能の実装
  - _Requirements: 3.4, 4.4_

- [ ] 9. シナリオ管理機能の実装

- [ ] 9.1 シナリオデータモデルとCRUD操作の実装
  - Scenarioインターフェースの定義
  - シナリオ作成・編集・削除のAPI実装
  - シーン管理機能の実装
  - _Requirements: 4.1, 4.2_

- [ ] 9.2 演出素材管理機能の実装
  - 音楽・画像・テキスト素材のアップロード機能
  - Cloudinary統合による素材管理
  - シーンごとの素材紐付け機能の実装
  - _Requirements: 4.2_


- [ ] 9.3 セッション中の演出制御機能の実装

  - 演出素材のワンクリック呼び出し機能
  - 参加者への素材同期配信機能
  - 演出タイムライン管理機能の実装
  - _Requirements: 4.3, 4.4_

- [ ] 10. AI統合基盤の構築

  - OpenAI API統合の実装
  - AI機能の利用回数制限システムの実装
  - エラーハンドリングとフォールバック機能の実装
  - _Requirements: 5.3, 6.4, 8.4, 9.4_

- [ ] 11. AI描写補助機能の実装

- [ ] 11.1 描写生成APIの実装
  - キーワードから描写文を生成するAPI作成
  - プロンプトエンジニアリングによる品質向上
  - 生成結果のキャッシュ機能の実装
  - _Requirements: 5.1, 5.4_

- [ ] 11.2 描写補助UIの実装
  - キーワード入力フォームの作成
  - 生成された描写文の表示とコピー機能
  - 再生成オプションの実装
  - チャットへの直接投稿機能の実装
  - _Requirements: 5.2, 5.4_

- [ ] 12. AIロールプレイ提案機能の実装

- [ ] 12.1 ロールプレイ提案エンジンの実装
  - キャラクター情報と状況を考慮した提案生成API
  - SANチェック失敗等の自動トリガー機能
  - 複数選択肢の生成と評価機能
  - _Requirements: 6.1, 6.2_

- [ ] 12.2 ロールプレイ提案UIの実装
  - 状況入力フォームの作成
  - 提案選択肢の表示UI
  - 自動提案の通知機能
  - 提案履歴の管理機能
  - _Requirements: 6.3, 6.4_

- [ ] 13. セッションログ保存機能の実装

- [ ] 13.1 ログ記録システムの実装
  - チャットログの自動保存機能
  - ダイスロール結果の記録機能
  - 音声録音機能の実装（ブラウザAPI使用）
  - ログのプライバシー設定機能
  - _Requirements: 7.1, 7.2, 7.4_

- [ ] 13.2 ログ管理UIの実装
  - セッション一覧からのログアクセス機能

  - ログの検索・フィルタリング機能
  - ログのエクスポート機能
  - 保存完了通知の実装
  - _Requirements: 7.2, 7.3_

- [ ] 14. AIあらすじ生成機能の実装

- [ ] 14.1 あらすじ生成エンジンの実装
  - セッションログから要点抽出するAPI
  - 簡潔なあらすじ生成アルゴリズム
  - SNS投稿用フォーマット生成機能
  - _Requirements: 8.1, 8.2_

- [ ] 14.2 あらすじ共有UIの実装
  - あらすじ生成ボタンと結果表示
  - SNS共有ボタンの実装
  - 共有用テキストのカスタマイズ機能
  - 生成履歴の管理機能
  - _Requirements: 8.2, 8.3, 8.4_

- [ ] 15. AI小説生成機能の実装

- [ ] 15.1 小説生成エンジンの実装
  - チャットログの自然な会話への変換API
  - ダイスロール結果の描写への変換機能
  - Stable Diffusion統合による挿絵生成
  - 生成コンテンツの品質管理機能
  - _Requirements: 9.1, 9.2_

- [ ] 15.2 小説出力とダウンロード機能の実装
  - 生成された小説のレイアウト機能
  - PDF・EPUB形式でのエクスポート機能
  - 挿絵の適切な配置機能
  - ダウンロード進捗表示の実装
  - _Requirements: 9.3, 9.4_

- [ ] 16. 有料機能とサブスクリプション管理

- [ ] 16.1 サブスクリプション管理システムの実装
  - ユーザーの課金状態管理機能
  - 機能制限の実装（キャラクターシート保存数、AI利用回数）
  - 有料プラン案内UI の実装
  - _Requirements: 2.4, 5.3, 6.4, 8.4, 9.4_

- [ ] 16.2 有料スキン機能の実装
  - スキン管理システムの実装
  - スキン購入・適用機能
  - スキンプレビュー機能
  - 購入履歴管理機能
  - _Requirements: 10.2, 10.3_

- [ ] 17. テスト実装とQA

- [ ] 17.1 ユニットテストの実装
  - 各コンポーネントのテスト作成
  - API エンドポイントのテスト実装
  - ユーティリティ関数のテスト作成
  - テストカバレッジ80%以上の達成
  - _Requirements: 全要件のテスト担保_


- [ ] 17.2 統合テストとE2Eテストの実装
  - ユーザージャーニーのE2Eテスト作成
  - AI機能の統合テスト実装
  - リアルタイム機能のテスト作成
  - パフォーマンステストの実装
  - _Requirements: 全要件の統合テスト_

- [ ] 18. 本番環境デプロイとモニタリング

  - Vercelへのデプロイ設定
  - 環境変数とシークレット管理
  - エラー監視とログ管理の設定
  - パフォーマンス監視の実装
  - _Requirements: 全要件の本番稼働_